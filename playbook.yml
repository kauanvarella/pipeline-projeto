- hosts: Projeto
  become: yes
  tasks: 
    - name: Atualizando pacotes do sistema
      yum:
        name: '*'
        update_cache: yes
      
    - name: Instalando Python3
      yum: 
        name: python3
        update_cache: yes
      
    - name: Instalando pip
      yum:
        name: python-pip
        update_cache: yes

    - name: Instalando Polkit
      yum:
        name: polkit
        update_cache: yes

    - name: Instalando Docker
      yum:
        name: docker
        state: latest

    - name: Iniciando o servico do Docker
      service:
        name: docker
        state: started
      become: true

    - name: Habilitando o Docker
      shell: systemctl enable docker
      shell: usermod -a -G docker ec2-user
      shell: chown $USER /var/run/docker.sock

    - name: Instalando Docker SDK Python
      pip:
        name: docker

    - name: Instalando o Docker Compose
      shell: curl -L https://github.com/docker/compose/releases/download/1.22.0/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose

    - name: Permissao de execucao Docker Compose
      file: dest=/usr/local/bin/docker-compose mode=a+x

    - name: Instalando o Git
      yum:
        name: git
        state: latest

    - name: Clonando o repositorio
      git:
        repo: https://github.com/kauanvarella/meu-app.git
        dest: /home/ec2-user/projeto-app
        clone: yes
        version: master
        update: yes

    - name: Subindo o Docker Compose
      docker_compose:
        project_src: /home/ec2-user/projeto-app
      become: true